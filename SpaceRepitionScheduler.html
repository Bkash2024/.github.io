<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaced Repetition Planner</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f4f7f6;
            display: grid;
            place-items: center;
            min-height: 90vh;
            color: #333;
        }
        .container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 500px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }
        input[type="text"],
        input[type="date"] {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box; /* Important for padding to work nicely */
        }
        button {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            font-weight: 700;
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        .schedule-info {
            font-size: 0.9rem;
            color: #777;
            text-align: center;
            margin-top: 1.5rem;
            line-height: 1.4;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Study Schedule Generator</h1>
        
        <div class="form-group">
            <label for="topic">What topic are you learning?</label>
            <input type="text" id="topic" placeholder="e.g., Python OOP">
        </div>

        <div class="form-group">
            <label for="startDate">When did you study it?</label>
            <input type="date" id="startDate">
        </div>

        <button id="generateBtn">Generate .ics File</button>

        <div class="schedule-info">
            This will create a calendar file with 4 review sessions:<br>
            +24 hours, +72 hours, +7 days, and +15 days.
        </div>
    </div>

    <script>
        // Set the default date to today
        document.getElementById('startDate').valueAsDate = new Date();

        // Attach event listener to the button
        document.getElementById('generateBtn').addEventListener('click', generateICS);

        /**
         * Main function to generate the ICS content and trigger download.
         */
        function generateICS() {
            const topic = document.getElementById('topic').value;
            const startDateValue = document.getElementById('startDate').value;

            // Simple validation
            if (!topic || !startDateValue) {
                alert('Please fill in both the topic and the start date.');
                return;
            }

            // Your specified repetition schedule (in days)
            // 24hr = 1 day, 72hr = 3 days, 7 days, 15 days
            const intervals = [1, 3, 7, 15];

            // The base date from the user input.
            // new Date(dateString) creates a date at midnight in the *local* timezone, 
            // but we add a day to get the correct start date.
            const startDate = new Date(startDateValue + 'T00:00:00');

            // We need a unique ID for the whole series of events
            const uniqueAppID = "spaced-rep-gen-" + Date.now();

            let icsEvents = [];

            intervals.forEach((days, index) => {
                let reviewDate = new Date(startDate.getTime());
                reviewDate.setDate(reviewDate.getDate() + days);

                // For all-day events, DTEND is the day *after* DTSTART
                let nextDay = new Date(reviewDate.getTime());
                nextDay.setDate(nextDay.getDate() + 1);

                const event = [
                    'BEGIN:VEVENT',
                    'UID:' + uniqueAppID + '-' + index, // Unique ID for this specific event
                    'DTSTAMP:' + formatDateICS(new Date()), // When this event was created (now)
                    'DTSTART;VALUE=DATE:' + formatDateICS(reviewDate),
                    'DTEND;VALUE=DATE:' + formatDateICS(nextDay),
                    'SUMMARY:Review #' + (index + 1) + ': ' + topic,
                    'DESCRIPTION:Spaced repetition review for "' + topic + '".\\nThis is review #' + (index + 1) + ' of ' + intervals.length + '.\\nOriginal study date: ' + startDate.toLocaleDateString(),
                    'TRANSP:TRANSPARENT', // Shows as "Free" not "Busy"
                    // Add a reminder (alarm) for 9 AM on the day of the event
                    'BEGIN:VALARM',
                    'ACTION:DISPLAY',
                    'DESCRIPTION:Time to review ' + topic,
                    'TRIGGER;VALUE=DATE-TIME:' + formatDateICS(reviewDate) + 'T090000',
                    'END:VALARM',
                    'END:VEVENT'
                ].join('\r\n'); // \r\n is the required line ending for ICS

                icsEvents.push(event);
            });

            // Create the full calendar file content
            const icsFileContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//YourSpacedRepApp//EN',
                ...icsEvents,
                'END:VCALENDAR'
            ].join('\r\n');

            // Trigger the download
            download(topic.replace(/[^a-z0-9]/gi, '_') + '_schedule.ics', icsFileContent);
        }

        /**
         * Helper function to format a Date object into 'YYYYMMDD' for ICS all-day events.
         * @param {Date} date - The date to format
         * @returns {string} - The date in YYYYMMDD format
         */
        function formatDateICS(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(date.getDate()).padStart(2, '0');
            
            // If we're formatting a time, add that too
            if(arguments.length > 1 || date.getHours() > 0 || date.getMinutes() > 0 || date.getSeconds() > 0) {
                 const hours = String(date.getHours()).padStart(2, '0');
                 const minutes = String(date.getMinutes()).padStart(2, '0');
                 const seconds = String(date.getSeconds()).padStart(2, '0');
                 return `${year}${month}${day}T${hours}${minutes}${seconds}`;
            }

            return `${year}${month}${day}`;
        }
        
        /**
         * Triggers a browser download of a text file.
         * @param {string} filename - The desired name of the file
         * @param {string} text - The content of the file
         */
        function download(filename, text) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/calendar;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }

    </script>
</body>
</html>
